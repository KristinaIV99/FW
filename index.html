<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskWarrior Composer</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaskComposer">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <link rel="stylesheet" href="projekt/css/main.css">
</head>
<body>
    <div class="main-container">
        <div class="app-header">
            <h1>TASKWARRIOR COMPOSER</h1>
            
            <!-- PRIDƒñTI ≈†IƒÑ SEKCIJƒÑ: -->
            <div id="installPrompt" class="install-prompt" style="display: none;">
                <button id="installBtn" class="install-btn">üì± ƒÆdiegti programƒólƒô</button>
            </div>
        </div>

        <!-- 0.5. COMMAND MODE -->
        <div class="task-card" data-card="commandmode">
            <div class="card-header">
                <h2>TaskWarrior COMMAND MODE</h2>
                <button class="help-btn" onclick="showHelpModal('COMMANDMODE')" title="Pagalba apie Command Mode">?</button>
            </div>
            <div class="card-content">
                <!-- Turinys bus sugeneruotas JavaScript -->
                <div id="commandModeContainer">
                    <!-- Command mode elementai bus ƒçia -->
                </div>
            </div>
        </div>

        <!-- 1. DESCRIPTION - privaloma -->
        <div class="task-card" data-card="description">
            <div class="card-header">
                <h2>TaskWarrior DESCRIPTION *</h2>
                <button class="help-btn" onclick="showHelpModal('DESCRIPTION')" title="Pagalba apie DESCRIPTION laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <!-- Description kategorijos -->
                <div class="description-categories" id="descriptionCategories">
                    <!-- Kategorijos bus sugeneruotos JavaScript -->
                </div>
            </div>
        </div>

        <!-- 2. PROJECT -->
        <div class="task-card" data-card="project">
            <div class="card-header">
                <h2>TaskWarrior PROJECT</h2>
                <button class="help-btn" onclick="showHelpModal('PROJECT')" title="Pagalba apie PROJECT laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <!-- Project kategorijos -->
                <div class="project-categories" id="projectCategories">
                    <!-- Kategorijos bus sugeneruotos JavaScript -->
                </div>
            </div>
        </div>

        <!-- 3. TAGS -->
        <div class="task-card" data-card="tags">
            <div class="card-header">
                <h2>TaskWarrior TAGS</h2>
                <button class="help-btn" onclick="showHelpModal('TAGS')" title="Pagalba apie TAGS laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <div class="tags-categories" id="tagsCategories"></div>
                <div class="global-preview-section">
                    <div class="preview-title">TaskWarrior Tags Preview:</div>
                    <div class="command-output" id="tagsCommandOutput">
                        <span class="no-command">Nepasirinkti jokie tag≈≥ laukai</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. PRIORITY - pakeista strukt≈´ra -->
        <div class="task-card" data-card="priority">
            <div class="card-header">
                <h2>TaskWarrior PRIORITY</h2>
                <button class="help-btn" onclick="showHelpModal('PRIORITY')" title="Pagalba apie PRIORITY laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <div class="priority-buttons" id="priorityButtons">
                    <!-- Mygtukai bus sugeneruoti JavaScript -->
                </div>
            </div>
        </div>

        <!-- 5. DATE & TIME -->
        <div class="task-card" data-card="datetime">
            <div class="card-header">
                <h2>TaskWarrior DATE & TIME</h2>
                <button class="help-btn" onclick="datetimeCard.showDateTimeHelp()" title="Pagalba apie datetime laukus">?</button>
            </div>
            <div class="card-content">
                <!-- Turinys bus sugeneruotas JavaScript naujoje datetime-card.js -->
                <!-- 5 field cards: DUE, WAIT, SCHEDULED, RECUR, UNTIL -->
            </div>
        </div>

        <!-- 6. ESTIMATE -->
        <div class="task-card" data-card="estimate">
            <div class="card-header">
                <h2>TaskWarrior ESTIMATE</h2>
                <button class="help-btn" onclick="showHelpModal('ESTIMATE')" title="Pagalba apie ESTIMATE laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <!-- Estimate laukai bus sugeneruoti JavaScript -->
                <div class="estimate-categories" id="estimateCategories">
                    <!-- Kategorijos bus sugeneruotos JavaScript -->
                </div>
            </div>
        </div>

        <!-- 7. ACTIONS -->
        <div class="task-card" data-card="actions">
            <div class="card-header">
                <h2>TaskWarrior</h2>
            </div>
            <div class="card-content">
                <!-- Mygtukai PIRMA -->
                <div class="segmented-actions">
                    <button class="seg-action save" id="saveBtn">SAVE</button>
                    <button class="seg-action export" id="exportBtn">EXPORT</button>
                </div>
                
                <!-- Real-time preview zona ANTRA -->
                <div class="global-preview-section" id="commandPreviewContainer">
                    <div id="commandPreview">
                        <!-- Preview bus ƒçia -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 8. STATISTICS -->
        <div class="task-card stats-card" data-card="stats">
            <div class="card-content">
                <div class="stats-display">
                    I≈°saugota u≈æduoƒçi≈≥: <span id="taskCount">0</span>
                </div>
            </div>
        </div>

        <!-- 9. STATUS -->
        <div class="task-card status-card" data-card="status">
            <div class="card-content">
                <div class="status-display">
                    <span class="status-indicator online" id="statusIndicator">üü¢</span>
                    <span class="status-text" id="statusText">Online</span>
                </div>
            </div>
        </div>

    </div> <!-- Closing main-container -->

    <!-- HELP MODAL -->
    <div id="helpModal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 id="helpModalTitle">Pagalba</h3>
                <span class="help-modal-close" onclick="closeHelpModal()">&times;</span>
            </div>
            <div class="help-modal-body" id="helpModalBody">
                <!-- Help tekstas bus ƒØstatytas ƒçia -->
            </div>
            <div class="help-modal-footer">
                <button class="help-modal-btn" onclick="closeHelpModal()">Gerai</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT IMPORTS - UPDATED -->
    <script src="projekt/localStorage-manager.js"></script>
    <script src="projekt/config.js"></script>
    <script src="projekt/data.js"></script>
    <script src="projekt/export-manager.js"></script>
    <script src="projekt/app.js"></script>
    <script src="projekt/cards/command-mode-card.js"></script>
    <script src="projekt/cards/description-card.js"></script>
    <script src="projekt/cards/project-card.js"></script>
    <script src="projekt/cards/tags-card.js"></script>
    <script src="projekt/cards/priority-card.js"></script>
    <script src="projekt/cards/estimate-card.js"></script>
    <script src="projekt/cards/actions-card.js"></script>
    <script src="projekt/cards/statistics-card.js"></script>
    
    <!-- DateTime scripts - SIMPLIFIED -->
    <script src="projekt/datetime/datetime-validation.js"></script>
    <script src="projekt/datetime/datetime-compatibility.js"></script>
    <script src="projekt/datetime/components/time-component.js"></script>
    <script src="projekt/datetime/components/calendar-component.js"></script>
    <script src="projekt/datetime/components/weekdays-component.js"></script>
    <script src="projekt/datetime/components/months-component.js"></script>
    <script src="projekt/datetime/components/monthdays-component.js"></script>  
    <script src="projekt/datetime/components/intervals-component.js"></script>
    <script src="projekt/datetime/components/intervals-iso-component.js"></script>
    <script src="projekt/datetime/datetime-card.js"></script>
    
    <!-- Help modal -->
    <script src="projekt/help-modal.js"></script>
    
    <!-- Update notification -->
    <div id="updateNotification" style="display: none;">
        <div class="update-banner">
            <span>üîÑ Naujas atnaujinimas prieinamas!</span>
            <button id="updateBtn">Atnaujinti dabar</button>
            <button id="dismissBtn">Vƒóliau</button>
        </div>
    </div>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/FW/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered');
                        
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification(newWorker);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
        
        function showUpdateNotification(newWorker) {
            const notification = document.getElementById('updateNotification');
            const updateBtn = document.getElementById('updateBtn');
            const dismissBtn = document.getElementById('dismissBtn');
            
            notification.style.display = 'block';
            
            updateBtn.onclick = () => {
                newWorker.postMessage({ type: 'SKIP_WAITING' });
                window.location.reload();
            };
            
            dismissBtn.onclick = () => {
                notification.style.display = 'none';
            };
        }
        
        // PRIDƒñTI ≈†ƒÆ KODƒÑ:
        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (installPrompt) {
                installPrompt.style.display = 'block';
            }
        });

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('User accepted install');
                }
                
                deferredPrompt = null;
                if (installPrompt) {
                    installPrompt.style.display = 'none';
                }
            });
        }

        window.addEventListener('appinstalled', () => {
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }
            console.log('PWA installed');
        });
    </script>
</body>
</html>